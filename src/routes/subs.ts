import express from "express";
import User from "../models/user";
import Article from "../models/article";
import { checkAuth } from "../middlewares/checkAuth";
import {stripe} from "../utils/stripe"

const router = express.Router();

router.get("/prices" , checkAuth ,async(req,res)=>{
    const prices = await  stripe.prices.list({
        apiKey:process.env.STRIPE_SECRET_KEY,
    });
    return res.json(prices);
})

router.post("/session" , checkAuth ,async (req,res)=>{
    const user = await User.findOne({ email: req.user });
   
   
// Article.create({
//     title:"you are broke why ?? 15 reasons why",
//     imageUrl:"data:image/jpeg;base64,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",
//     content:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris tempus diam et ornare malesuada. Praesent vel magna et augue iaculis consectetur vitae non orci. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Sed eu elit nec nunc ultricies porta ut sit amet velit. Sed a mattis arcu. Aliquam vel fringilla purus, a euismod magna. Aenean interdum lectus ut euismod pharetra. Cras turpis turpis, euismod a diam eget, finibus facilisis purus. Sed magna leo, tincidunt sit amet mauris quis, mollis aliquet arcu. Donec laoreet eget ipsum ut vulputate. Nam elementum dignissim justo a varius. Curabitur non nulla non eros egestas ultricies. Quisque vitae massa sed justo rutrum congue. Etiam ornare quis lacus dapibus aliquam. Donec quis felis eget sem mattis tempus. Suspendisse lobortis lacus sit amet sapien pulvinar, sed sagittis lacus condimentum.",
//     access:"Standard"
// })

    const session = await  stripe.checkout.sessions.create({
       mode:"subscription",
       payment_method_types:["card"],
       line_items:[{
           price:req.body.priceId,
           quantity:1 },	
        ],
       success_url:"http://localhost:3000/articles",
       cancel_url:"http://localhost:3000/article-plans",
       customer: user.stripeCustomerId,

    },{
        apiKey:process.env.STRIPE_SECRET_KEY,
    });
    return res.json(session);
})
export default router;